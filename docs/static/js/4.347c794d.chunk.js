(this["webpackJsonpreact-roller-advanced-notation-v105"]=this["webpackJsonpreact-roller-advanced-notation-v105"]||[]).push([[4],{20:function(e,t,i){"use strict";i.r(t),i.d(t,"default",function(){return w});var o=i(2),s=i(21);i(5);const n=["id","value"];var l,a,h,d,r,c,u=Object.defineProperty,p=(e,t,i)=>(((e,t,i)=>{t in e?u(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i})(e,"symbol"!=typeof t?t+"":t,i),i),v=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},m=(e,t,i)=>(v(e,t,"read from private field"),i?i.call(e):t.get(e)),f=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},g=(e,t,i,o)=>(v(e,t,"write to private field"),o?o.call(e,i):t.set(e,i),i),R=(e,t,i,o)=>({set _(o){g(e,t,o,i)},get _(){return m(e,t,o)}});class w{constructor(e){p(this,"config"),f(this,l,void 0),p(this,"initialized",!1),f(this,a,{}),f(this,h,0),f(this,d,0),f(this,r,[]),f(this,c,void 0),p(this,"noop",()=>{}),this.onInitComplete=e.onInitComplete||this.noop,this.onThemeLoaded=e.onThemeLoaded||this.noop,this.onRollResult=e.onRollResult||this.noop,this.onRollComplete=e.onRollComplete||this.noop,this.onDieRemoved=e.onDieRemoved||this.noop,this.initialized=this.initScene(e)}async initScene(e){this.config=e.options,this.onInitComplete()}resize(){}loadTheme(){return Promise.resolve()}updateConfig(e){Object.assign(this.config,e)}addNonDie(e){console.log("die",e),clearTimeout(m(this,c));const{id:t,value:i}=e,s={id:t,value:i,config:Object(o.a)(e,n)};m(this,a)[t]=s,m(this,r).push(setTimeout(()=>{this.handleAsleep(s)},R(this,h)._++*this.config.delay)),g(this,c,setTimeout(()=>{this.onRollComplete()},500))}add(e){console.log("add die"),this.addNonDie(e)}remove(e){console.log("remove die");const t=m(this,a)[e.id];t.hasOwnProperty("d10Instance")&&(delete m(this,a)[t.d10Instance.id],R(this,d)._--),delete m(this,a)[e.id],R(this,d)._--,this.onDieRemoved(e.rollId)}clear(){!Object.keys(m(this,a)).length&&!m(this,d)||(m(this,r).forEach(e=>clearTimeout(e)),Object.values(m(this,a)).forEach(e=>{e.mesh&&e.mesh.dispose()}),g(this,a,{}),g(this,h,0),g(this,d,0))}async handleAsleep(e){var t,i;if(e.asleep=!0,await s.e.getRollResult(e),e.d10Instance||e.dieParent){if(null!=(t=null==e?void 0:e.d10Instance)&&t.asleep||null!=(i=null==e?void 0:e.dieParent)&&i.asleep){const t=100===e.config.sides?e:e.dieParent,i=10===e.config.sides?e:e.d10Instance;0===i.value&&0===t.value?t.value=100:t.value=t.value+i.value,this.onRollResult({rollId:t.config.rollId,value:t.value})}}else 10===e.config.sides&&0===e.value&&(e.value=10),this.onRollResult({rollId:e.config.rollId,value:e.value});R(this,d)._++}}l=new WeakMap,a=new WeakMap,h=new WeakMap,d=new WeakMap,r=new WeakMap,c=new WeakMap}}]);
//# sourceMappingURL=4.347c794d.chunk.js.map